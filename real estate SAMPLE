// HPI 1.4-G
import { useState, useEffect, useRef } from 'react';
import { Link } from 'react-router-dom';
import { Search, MapPin, Star, ArrowRight, Phone, Mail, Calendar, BedDouble, Bath, LandPlot } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent } from '@/components/ui/card';
import { Image } from '@/components/ui/image';

interface UseIntersectionObserverOptions extends IntersectionObserverInit {
  triggerOnce?: boolean;
}

const useIntersectionObserver = (options: UseIntersectionObserverOptions) => {
  const containerRef = useRef<HTMLDivElement>(null);
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    const { triggerOnce, ...observerOptions } = options;
    
    const observer = new IntersectionObserver(([entry]) => {
      if (entry.isIntersecting) {
        setIsVisible(true);
        if (triggerOnce) {
          observer.disconnect();
        }
      }
    }, observerOptions);

    if (containerRef.current) {
      observer.observe(containerRef.current);
    }

    return () => {
      if (containerRef.current) {
        observer.unobserve(containerRef.current);
      }
    };
  }, [containerRef, options]);

  return [containerRef, isVisible] as const;
};

const AnimatedSection = ({ children, className = '' }) => {
  const [ref, isVisible] = useIntersectionObserver({ threshold: 0.1, triggerOnce: true });
  return (
    <div
      ref={ref}
      className={`transition-opacity duration-1000 ease-in-out ${className} ${isVisible ? 'opacity-100' : 'opacity-0 translate-y-5'}`}
    >
      {children}
    </div>
  );
};

const featuredProperties = [
  {
    id: '1',
    title: 'Modern Villa in Karen',
    location: 'Karen, Nairobi',
    price: 'KSh 45,000,000',
    bedrooms: 4,
    bathrooms: 3,
    area: '350 sqm',
    image: 'https://static.wixstatic.com/media/9baa27_8169032ebc0341d29ca8a365fe936409~mv2.png?originWidth=768&originHeight=576',
    type: 'Villa'
  },
  {
    id: '2',
    title: 'Luxury Apartment in Westlands',
    location: 'Westlands, Nairobi',
    price: 'KSh 25,000,000',
    bedrooms: 3,
    bathrooms: 2,
    area: '180 sqm',
    image: 'https://static.wixstatic.com/media/9baa27_4f73bb6270a74c1188b5c464a4ba0e5a~mv2.png?originWidth=768&originHeight=576',
    type: 'Apartment'
  },
  {
    id: '3',
    title: 'Commercial Plot in CBD',
    location: 'CBD, Nairobi',
    price: 'KSh 120,000,000',
    bedrooms: 0,
    bathrooms: 0,
    area: '500 sqm',
    image: 'https://static.wixstatic.com/media/9baa27_26d440fe49b2406e8182bb1b5780a033~mv2.png?originWidth=768&originHeight=576',
    type: 'Commercial'
  }
];

const testimonials = [
  {
    name: 'Sarah Mwangi',
    role: 'Property Buyer',
    content: 'Wendo Real Estate helped me find my dream home in Karen. Their professional service and attention to detail made the entire process seamless. The experience was truly bespoke.',
    rating: 5,
    image: 'https://static.wixstatic.com/media/9baa27_6a49d11ee7bd44c1a70bd07e0e6c8e45~mv2.png?originWidth=128&originHeight=128'
  },
  {
    name: 'James Kiprotich',
    role: 'Investor',
    content: 'Excellent investment opportunities and market insights. Wendo\'s team guided me through multiple property acquisitions with great success. Their precision is unmatched.',
    rating: 5,
    image: 'https://static.wixstatic.com/media/9baa27_afc92c0c654040789cf8d7689131384c~mv2.png?originWidth=128&originHeight=128'
  },
  {
    name: 'Grace Wanjiku',
    role: 'Property Seller',
    content: 'They sold my property in Kilimani within 3 weeks at a great price. Professional, reliable, and results-driven. A truly tailored service from start to finish.',
    rating: 5,
    image: 'https://static.wixstatic.com/media/9baa27_9bd7e4b1dbd3435ba58d3361024b6d7b~mv2.png?originWidth=128&originHeight=128'
  }
];

const services = [
    { title: 'Property Sales', description: 'Expert guidance in buying and selling residential and commercial properties.', icon: 'ðŸ ' },
    { title: 'Property Management', description: 'Professional management services for your investment properties.', icon: 'ðŸ”‘' },
    { title: 'Investment Consulting', description: 'Strategic advice for real estate investment opportunities.', icon: 'ðŸ“ˆ' },
    { title: 'Property Valuation', description: 'Accurate property valuations by certified professionals.', icon: 'ðŸ’°' },
    { title: 'Legal Services', description: 'Complete legal support for property transactions.', icon: 'âš–ï¸' },
    { title: 'Mortgage Assistance', description: 'Help securing the best financing options for your property.', icon: 'ðŸ¦' }
];

export default function HomePage() {
  const [searchQuery, setSearchQuery] = useState('');
  const [location, setLocation] = useState('');
  const [activeTestimonial, setActiveTestimonial] = useState(0);

  const handleSearch = () => {
    window.location.href = `/properties?search=${encodeURIComponent(searchQuery)}&location=${encodeURIComponent(location)}`;
  };

  const nextTestimonial = () => {
    setActiveTestimonial((prev) => (prev + 1) % testimonials.length);
  };

  const prevTestimonial = () => {
    setActiveTestimonial((prev) => (prev - 1 + testimonials.length) % testimonials.length);
  };

  return (
    <div className="bg-background text-foreground font-paragraph w-full overflow-clip">
      <style>{`
        .hero-gradient-overlay::after {
          content: '';
          position: absolute;
          inset: 0;
          background: linear-gradient(to top, rgba(0,0,0,0.5), transparent 60%);
          z-index: 2;
        }
        .testimonial-card {
          transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .testimonial-card:not(.active) {
          opacity: 0;
          transform: scale(0.95);
          pointer-events: none;
          position: absolute;
        }
        .architectural-brackets::before, .architectural-brackets::after {
          content: '';
          position: absolute;
          width: 4rem;
          height: 4rem;
          border-color: var(--color-soft-gold);
          transition: all 0.3s ease-in-out;
        }
        .architectural-brackets::before {
          top: -1px;
          left: -1px;
          border-top-width: 2px;
          border-left-width: 2px;
        }
        .architectural-brackets::after {
          bottom: -1px;
          right: -1px;
          border-bottom-width: 2px;
          border-right-width: 2px;
        }
        .group:hover .architectural-brackets::before, .group:hover .architectural-brackets::after {
          width: calc(100% + 2px);
          height: calc(100% + 2px);
        }
      `}</style>
      
      <section className="relative w-full h-screen min-h-[700px] flex items-center justify-center text-center text-primary-foreground hero-gradient-overlay">
        <div className="absolute inset-0 bg-primary/30 z-[1]"></div>
        <Image
          src="https://static.wixstatic.com/media/9baa27_1e09b0f46b0d45a19b620e55c974838e~mv2.png?originWidth=1920&originHeight=1024"
          alt="Expansive view of a modern luxury home in Kenya at dusk"
          width={1920}
          height={1080}
          className="absolute inset-0 w-full h-full object-cover"
        />
        <div className="relative z-10 flex flex-col items-center px-6 space-y-8 max-w-4xl">
          <h1 className="text-5xl md:text-7xl lg:text-8xl font-heading font-bold text-white" style={{ textShadow: '0 2px 10px rgba(0,0,0,0.3)' }}>
            Your Bespoke Property Journey
          </h1>
          <p className="text-lg md:text-xl text-white/90 max-w-2xl">
            Discover premium properties across Kenya with Wendo Real Estate. Your trusted partner in finding exceptional homes and investment opportunities.
          </p>
          <div className="flex flex-col sm:flex-row gap-4 pt-4">
            <Button size="lg" asChild className="bg-soft-gold hover:bg-soft-gold/90 text-primary-foreground">
              <Link to="/properties" className="flex items-center gap-2">
                Explore Properties <ArrowRight className="w-4 h-4" />
              </Link>
            </Button>
            <Button variant="outline" size="lg" asChild className="border-white text-white hover:bg-white hover:text-primary">
              <Link to="/contact" className="flex items-center gap-2">
                <Calendar className="w-4 h-4" /> Book Consultation
              </Link>
            </Button>
          </div>
        </div>
      </section>

      <section className="w-full py-24 lg:py-32 bg-white">
        <div className="max-w-[120rem] mx-auto px-6 lg:px-12">
          <AnimatedSection className="flex flex-col lg:flex-row items-center justify-between gap-8 lg:gap-16 mb-16">
            <div className="w-full lg:w-1/3 text-center lg:text-left">
              <span className="font-heading text-soft-gold text-xl">01</span>
              <h2 className="text-4xl lg:text-5xl font-heading text-primary mt-2">Curated Residences</h2>
            </div>
            <p className="w-full lg:w-2/3 max-w-3xl text-lg text-foreground/70 text-center lg:text-left">
              Each property in our portfolio is meticulously selected to meet our high standards of quality, design, and location. Explore a handpicked collection of Kenya's finest homes and investment opportunities.
            </p>
          </AnimatedSection>
          
          <AnimatedSection className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {featuredProperties.map((property, index) => (
              <Link to={`/property/${property.id}`} key={property.id} className="group block">
                <Card className="overflow-hidden border-gray-200/80 shadow-sm hover:shadow-2xl transition-all duration-500 ease-in-out h-full">
                  <div className="relative h-80">
                    <Image
                      src={property.image}
                      alt={property.title}
                      width={800}
                      height={600}
                      className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                    />
                    <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                    <div className="absolute top-4 left-4 bg-primary text-primary-foreground px-3 py-1 rounded-full text-sm font-paragraph">
                      {property.type}
                    </div>
                  </div>
                  <CardContent className="p-6 bg-background">
                    <h3 className="text-2xl font-heading font-semibold text-primary mb-2 group-hover:text-soft-gold transition-colors">
                      {property.title}
                    </h3>
                    <div className="flex items-center text-foreground/70 mb-4">
                      <MapPin className="w-4 h-4 mr-2 text-soft-gold" />
                      <span className="font-paragraph text-sm">{property.location}</span>
                    </div>
                    <div className="text-3xl font-heading font-bold text-primary mb-5">
                      {property.price}
                    </div>
                    <div className="flex items-center justify-start gap-6 text-sm font-paragraph text-foreground/80 border-t border-gray-200 pt-4">
                      {property.bedrooms > 0 && <span className="flex items-center gap-2"><BedDouble className="w-5 h-5 text-soft-gold"/> {property.bedrooms} Beds</span>}
                      {property.bathrooms > 0 && <span className="flex items-center gap-2"><Bath className="w-5 h-5 text-soft-gold"/> {property.bathrooms} Baths</span>}
                      <span className="flex items-center gap-2"><LandPlot className="w-5 h-5 text-soft-gold"/> {property.area}</span>
                    </div>
                  </CardContent>
                </Card>
              </Link>
            ))}
             <div className="lg:col-span-2 flex justify-center items-center p-8 bg-gray-50 rounded-lg">
                <Button size="lg" asChild className="bg-primary hover:bg-primary/90 text-primary-foreground">
                  <Link to="/properties" className="flex items-center gap-2">
                    View All Properties <ArrowRight className="w-4 h-4" />
                  </Link>
                </Button>
            </div>
          </AnimatedSection>
        </div>
      </section>

      <section className="w-full py-24 lg:py-32 bg-background">
        <div className="max-w-[120rem] mx-auto px-6 lg:px-12">
          <div className="grid lg:grid-cols-2 gap-16 lg:gap-24 items-center">
            <AnimatedSection className="relative w-full h-[60vh] lg:h-[80vh]">
              <Image
                src="https://static.wixstatic.com/media/9baa27_b318bb26db81444cafacd6693ecfc9dc~mv2.png?originWidth=768&originHeight=960"
                alt="A serene and elegant modern interior with minimalist furniture"
                width={800}
                height={1000}
                className="w-full h-full object-cover rounded-lg"
              />
              <div className="architectural-brackets" style={{'--color-soft-gold': '#BFA182'} as React.CSSProperties}></div>
            </AnimatedSection>
            <AnimatedSection>
              <span className="font-heading text-soft-gold text-xl">02</span>
              <h2 className="text-4xl lg:text-5xl font-heading text-primary mt-2 mb-6">
                The Wendo Philosophy
              </h2>
              <div className="space-y-6 text-lg text-foreground/80">
                <p>
                  We believe that finding a property is more than a transaction; it's about crafting a space that reflects your aspirations. Our approach is built on a foundation of precision, integrity, and a deep understanding of our clients' unique needs.
                </p>
                <p>
                  Like a master tailor, we meticulously attend to every detail, ensuring a seamless fit between you and your new property. From initial consultation to final handover, we provide a serene, confident, and personalized experience.
                </p>
              </div>
              <Button variant="link" asChild className="text-soft-gold p-0 mt-8 text-lg h-auto hover:text-primary">
                <Link to="/about" className="flex items-center gap-2">
                  Learn More About Us <ArrowRight className="w-4 h-4" />
                </Link>
              </Button>
            </AnimatedSection>
          </div>
        </div>
      </section>

      <section className="w-full py-24 lg:py-32 bg-white">
        <div className="max-w-[120rem] mx-auto px-6 lg:px-12">
            <AnimatedSection className="text-center max-w-3xl mx-auto mb-16">
                <span className="font-heading text-soft-gold text-xl">03</span>
                <h2 className="text-4xl lg:text-5xl font-heading text-primary mt-2 mb-4">A Tailored Suite of Services</h2>
                <p className="text-lg text-foreground/70">Comprehensive real estate solutions designed to provide clarity and confidence at every step of your journey.</p>
            </AnimatedSection>
            <AnimatedSection className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {services.map((service, index) => (
                    <div key={index} className="border border-gray-200/80 p-8 rounded-lg text-center transition-all duration-300 hover:bg-background hover:shadow-lg hover:-translate-y-2">
                        <div className="text-5xl mb-6 flex justify-center items-center h-16">{service.icon}</div>
                        <h3 className="text-2xl font-heading font-semibold text-primary mb-3">{service.title}</h3>
                        <p className="font-paragraph text-foreground/70 leading-relaxed">{service.description}</p>
                    </div>
                ))}
            </AnimatedSection>
        </div>
      </section>

      <section className="w-full py-24 lg:py-32 bg-primary text-primary-foreground">
        <div className="max-w-[120rem] mx-auto px-6 lg:px-12">
          <div className="grid lg:grid-cols-12 gap-8 items-center">
            <div className="lg:col-span-4 text-center lg:text-left">
              <AnimatedSection>
                <span className="font-heading text-soft-gold text-xl">04</span>
                <h2 className="text-4xl lg:text-5xl font-heading mt-2 mb-6">Enduring Partnerships</h2>
                <p className="text-lg text-primary-foreground/80 mb-8">
                  Our success is measured by the lasting relationships we build. Hear directly from clients who have trusted us with their property journeys.
                </p>
                <div className="hidden lg:flex items-center gap-4">
                  <Button onClick={prevTestimonial} variant="outline" size="icon" className="border-white/50 text-white hover:bg-white/10 rounded-full">
                    <ArrowRight className="w-5 h-5 transform rotate-180" />
                  </Button>
                  <Button onClick={nextTestimonial} variant="outline" size="icon" className="border-white/50 text-white hover:bg-white/10 rounded-full">
                    <ArrowRight className="w-5 h-5" />
                  </Button>
                </div>
              </AnimatedSection>
            </div>
            <div className="lg:col-span-8 relative h-[500px] flex items-center justify-center">
              {testimonials.map((testimonial, index) => (
                <div
                  key={index}
                  className={`testimonial-card w-full ${index === activeTestimonial ? 'active' : ''}`}
                >
                  <Card className="bg-background/10 border-0 text-primary-foreground shadow-xl">
                    <CardContent className="p-8 md:p-12 flex flex-col md:flex-row items-center gap-8">
                      <Image
                        src={testimonial.image}
                        alt={testimonial.name}
                        width={150}
                        height={150}
                        className="w-24 h-24 md:w-36 md:h-36 rounded-full object-cover flex-shrink-0 border-4 border-soft-gold"
                      />
                      <div className="text-center md:text-left">
                        <div className="flex items-center justify-center md:justify-start mb-4">
                            {[...Array(5)].map((_, i) => (
                                <Star key={i} className="w-5 h-5 fill-soft-gold text-soft-gold" />
                            ))}
                        </div>
                        <blockquote className="text-xl font-heading italic mb-4">
                          "{testimonial.content}"
                        </blockquote>
                        <div className="font-heading font-semibold text-xl text-white">
                          {testimonial.name}
                        </div>
                        <div className="font-paragraph text-sm text-primary-foreground/70">
                          {testimonial.role}
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                </div>
              ))}
            </div>
             <div className="lg:hidden flex items-center gap-4 justify-center mt-8">
                <Button onClick={prevTestimonial} variant="outline" size="icon" className="border-white/50 text-white hover:bg-white/10 rounded-full">
                  <ArrowRight className="w-5 h-5 transform rotate-180" />
                </Button>
                <Button onClick={nextTestimonial} variant="outline" size="icon" className="border-white/50 text-white hover:bg-white/10 rounded-full">
                  <ArrowRight className="w-5 h-5" />
                </Button>
              </div>
          </div>
        </div>
      </section>

      <section className="py-24 lg:py-32 bg-white">
        <div className="max-w-4xl mx-auto px-6 text-center">
          <AnimatedSection>
            <span className="font-heading text-soft-gold text-xl">05</span>
            <h2 className="text-4xl lg:text-5xl font-heading text-primary mt-2 mb-4">
              Begin Your Consultation
            </h2>
            <p className="text-lg text-foreground/70 mb-8 max-w-2xl mx-auto">
              Ready to find your dream property or discuss your investment goals? Get in touch with our expert team today for personalized, confidential assistance.
            </p>
            <div className="bg-background p-8 rounded-lg shadow-sm border border-gray-200/80">
              <div className="grid md:grid-cols-3 gap-4 mb-6">
                <Input placeholder="Property Type (e.g. Villa)" className="font-paragraph h-12" />
                <Input 
                  placeholder="Location (e.g. Karen)"
                  value={location}
                  onChange={(e) => setLocation(e.target.value)}
                  className="font-paragraph h-12"
                />
                <Input placeholder="Keywords..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} className="font-paragraph h-12" />
              </div>
              <Button 
                onClick={handleSearch}
                className="w-full bg-soft-gold hover:bg-soft-gold/90 text-primary-foreground"
                size="lg"
              >
                <Search className="w-4 h-4 mr-2" />
                Search Properties
              </Button>
            </div>
            <div className="flex flex-col sm:flex-row gap-4 justify-center mt-8">
              <Button size="lg" asChild className="bg-primary hover:bg-primary/90 text-primary-foreground">
                <Link to="/contact" className="flex items-center gap-2">
                  <Phone className="w-4 h-4" /> Call Us Now
                </Link>
              </Button>
              <Button size="lg" variant="outline" asChild className="border-primary text-primary hover:bg-primary hover:text-primary-foreground">
                <Link to="/contact" className="flex items-center gap-2">
                  <Mail className="w-4 h-4" /> Send Message
                </Link>
              </Button>
            </div>
          </AnimatedSection>
        </div>
      </section>
    </div>
  );
}
